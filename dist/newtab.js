import{u as rt,a as Ot,g as k,b as G,c as ue,r as Vt,s as ut,d as mt,e as Yt,i as _t,f as jt,h as Kt}from"./api.js";function Xt(){document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");if(t){const o=chrome.i18n.getMessage(t);o&&(e.textContent=o)}}),document.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const t=e.getAttribute("data-i18n-placeholder");if(t){const o=chrome.i18n.getMessage(t);o&&e.setAttribute("placeholder",o)}}),document.querySelectorAll("[data-i18n-title]").forEach(e=>{const t=e.getAttribute("data-i18n-title");if(t){const o=chrome.i18n.getMessage(t);o&&e.setAttribute("title",o)}})}document.addEventListener("DOMContentLoaded",Xt);let c=null,Q=null,b=null,O=null;const r=document.getElementById("dial-grid"),y=document.getElementById("groups-container"),I=document.getElementById("custom-context-menu"),Zt=document.getElementById("ctx-sort-name-asc"),Qt=document.getElementById("ctx-sort-name-desc"),Jt=document.getElementById("ctx-sort-date-asc"),en=document.getElementById("ctx-sort-date-desc"),me=document.getElementById("modal"),tt=document.getElementById("modal-title"),tn=document.getElementById("add-btn"),nn=document.getElementById("close-modal"),on=document.getElementById("cancel-btn"),Ze=document.getElementById("dial-form"),gt=document.getElementById("dial-title"),pt=document.getElementById("dial-url"),J=document.getElementById("group-modal"),vt=document.getElementById("group-modal-title"),$=document.getElementById("scroll-up-btn"),H=document.getElementById("scroll-down-btn"),an=document.getElementById("add-group-btn"),sn=document.getElementById("close-group-modal"),dn=document.getElementById("cancel-group-btn"),Qe=document.getElementById("group-form"),Pe=document.getElementById("group-title"),ge=document.getElementById("advanced-group-modal"),ln=document.getElementById("advanced-group-modal-title"),ht=document.getElementById("adv-group-title-input"),cn=document.getElementById("close-advanced-group-modal"),rn=document.getElementById("adv-group-save-btn"),un=document.getElementById("adv-group-discard-btn"),pe=document.querySelectorAll(".adv-sidebar-btn"),yt=document.querySelectorAll(".adv-tab-content"),ee=document.getElementById("adv-group-cols-val"),nt=document.getElementById("adv-group-cols-up"),ot=document.getElementById("adv-group-cols-down"),te=document.getElementById("adv-group-rows-val"),at=document.getElementById("adv-group-rows-up"),st=document.getElementById("adv-group-rows-down"),ve=document.getElementById("adv-layout-dynamic"),he=document.getElementById("adv-layout-list"),ye=document.getElementById("adv-layout-grid"),mn=document.getElementById("adv-dyn-w-up"),gn=document.getElementById("adv-dyn-w-down"),Ne=document.getElementById("adv-dyn-w-val"),pn=document.getElementById("adv-dyn-h-up"),vn=document.getElementById("adv-dyn-h-down"),Ue=document.getElementById("adv-dyn-h-val"),it=document.getElementById("add-group-tab-btn");it&&it.addEventListener("click",e=>{e.stopPropagation(),b=null,vt.textContent="A√±adir Nuevo Grupo",Pe.value="",J.classList.remove("hidden"),setTimeout(()=>Pe.focus(),50)});const hn=document.getElementById("adv-list-w-up"),yn=document.getElementById("adv-list-w-down"),We=document.getElementById("adv-list-w-val"),ft=document.getElementById("adv-list-dir-h"),Et=document.getElementById("adv-list-dir-v"),Y=document.getElementById("adv-grid-fill"),_=document.getElementById("adv-grid-center"),fn=document.getElementById("adv-grid-aw-up"),En=document.getElementById("adv-grid-aw-down"),ze=document.getElementById("adv-grid-aw-val"),Ln=document.getElementById("adv-grid-ah-up"),bn=document.getElementById("adv-grid-ah-down"),Fe=document.getElementById("adv-grid-ah-val"),de=document.querySelectorAll(".adv-icon-choice"),M=document.getElementById("adv-text-color-enable"),W=document.getElementById("adv-text-color-hex"),B=document.getElementById("adv-text-color-picker"),Lt=document.querySelectorAll('input[name="bg"]'),Ge=document.getElementById("adv-bg-solid-body"),P=document.getElementById("adv-bg-solid-color"),qe=document.getElementById("adv-bg-solid-hex"),$e=document.getElementById("adv-bg-gradient-body"),bt=document.querySelectorAll('input[name="grad"]'),N=document.getElementById("adv-bg-grad-color1"),Re=document.getElementById("adv-bg-grad-hex1"),U=document.getElementById("adv-bg-grad-color2"),Oe=document.getElementById("adv-bg-grad-hex2"),T=document.getElementById("adv-gap-enable"),x=document.getElementById("adv-gap-range"),ce=document.getElementById("adv-gap-val"),j=document.getElementById("adv-open-window"),K=document.getElementById("adv-open-tab"),X=document.getElementById("adv-set-default"),S=document.getElementById("adv-is-locked"),z=document.getElementById("adv-password-container"),D=document.getElementById("adv-group-password"),fe=document.getElementById("advanced-modal-content"),Z=document.getElementById("advanced-modal-drag-handle");let Je=!1,It=0,Bt=0,Ee=0,Le=0;Z&&fe&&Z.addEventListener("mousedown",e=>{Je=!0,Z.style.cursor="grabbing",It=e.clientX-Ee,Bt=e.clientY-Le,document.addEventListener("mousemove",kt),document.addEventListener("mouseup",wt)});function kt(e){Je&&(Ee=e.clientX-It,Le=e.clientY-Bt,fe.style.transform=`translate(${Ee}px, ${Le}px)`)}function wt(){Je=!1,Z&&(Z.style.cursor="grab"),document.removeEventListener("mousemove",kt),document.removeEventListener("mouseup",wt)}const be=document.getElementById("stats-modal"),In=document.getElementById("close-stats-modal"),Bn=document.getElementById("stats-total-groups"),kn=document.getElementById("stats-total-dials"),wn=document.getElementById("stats-avg-dials"),Ie=document.getElementById("errors-modal"),xn=document.getElementById("close-errors-modal"),Cn=document.getElementById("errors-log-area"),Sn=document.getElementById("clear-errors-btn"),q=document.getElementById("search-modal"),Mn=document.getElementById("close-search-modal"),Ve=document.getElementById("search-dial-input"),re=document.getElementById("search-results-container"),R=document.getElementById("share-bottom-bar"),Tn=document.getElementById("share-bottom-select-all-btn"),Dn=document.getElementById("share-bottom-count"),An=document.getElementById("share-bottom-cancel-btn"),Gn=document.getElementById("share-bottom-up-btn"),ne=document.getElementById("share-modal-advanced"),$n=document.getElementById("close-advanced-share-modal"),Hn=document.getElementById("btn-back-to-selection"),Pn=document.getElementById("share-modal-count-text"),Nn=document.getElementById("share-modal-subtitle-text"),le=document.getElementById("share-selected-list"),xt=document.getElementById("share-title-input"),Un=document.getElementById("share-advanced-copy-btn"),Wn=document.getElementById("share-advanced-export-btn");let A=!1,m=new Set;const Ye=document.getElementById("settings-sidebar"),Ct=document.getElementById("settings-btn"),E=document.getElementById("dropdown-menu"),zn=document.getElementById("close-settings"),V=document.getElementById("toggle-edit-mode"),St=document.getElementById("settings-import-native-btn"),Fn=document.getElementById("settings-import-html-btn"),Mt=document.getElementById("settings-import-html-input"),Be=document.getElementById("onboarding-modal"),Tt=document.getElementById("onboarding-native-btn"),qn=document.getElementById("onboarding-html-btn"),Dt=document.getElementById("onboarding-html-input"),Rn=document.getElementById("skip-onboarding-btn"),At=["linear-gradient(135deg, #3b82f6, #8b5cf6)","linear-gradient(135deg, #10b981, #3b82f6)","linear-gradient(135deg, #f59e0b, #ef4444)","linear-gradient(135deg, #ec4899, #8b5cf6)","linear-gradient(135deg, #06b6d4, #3b82f6)"];function On(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);return Math.abs(t)%At.length}function Vn(e,t){if(e)return e.charAt(0).toUpperCase();try{return new URL(t).hostname.replace("www.","").charAt(0).toUpperCase()}catch{return"?"}}async function Yn(){const e=await k(),t=await ue(e[0]?.id||"");if(e.length===1&&e[0].title==="Inicio"&&t.length===0&&Be.classList.remove("hidden"),e.length>0){const o=e.find(n=>n.isDefault);o?c=o.id:c=e[0].id}await C(),c&&await f()}function _e(){!$||!H||!y||(y.scrollHeight>y.clientHeight?(y.scrollTop>0?$.classList.remove("hidden"):$.classList.add("hidden"),Math.ceil(y.scrollTop+y.clientHeight)>=y.scrollHeight?H.classList.add("hidden"):H.classList.remove("hidden")):($.classList.add("hidden"),H.classList.add("hidden")))}async function C(){const e=await k();y.innerHTML="",e.length>0&&!c&&(c=e[0].id);for(const t of e){const o=document.createElement("div"),n=await ue(t.id);let s=!1;A&&n.length>0&&(s=n.every(u=>m.has(u.id))),o.className=`group-tab ${t.id===c?"active":""} ${s?"is-share-selected":""}`;const i=t.textColor?`style="color: ${t.textColor} !important;"`:"";let d=t.groupIcon?`<span style="margin-right: 6px; font-size: 1.1rem; line-height: 1;">${t.groupIcon}</span>`:"";t.isLocked&&(d+='<svg style="margin-right: 4px; width: 14px; height: 14px; opacity: 0.7;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>'),t.isDefault&&(d+='<svg style="margin-right: 4px; width: 14px; height: 14px; opacity: 0.5;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>'),o.innerHTML=`
      <div class="group-share-check">
         <svg viewBox="0 0 24 24" fill="none" class="icon" stroke="currentColor" stroke-width="3" style="width:10px; height:10px;"><polyline points="20 6 9 17 4 12"></polyline></svg>
      </div>
      <span class="group-icon-container">${d}</span>
      <span class="group-title" ${i}>${t.title.replace(/^[üìÅüìÇ]\s*/,"").trim()||t.title}</span>
      <div class="group-tab-actions">
        <button class="btn-icon-small edit-group-btn" data-id="${t.id}" title="Editar Grupo">‚úèÔ∏è</button>
        ${e.length>1?`<button class="btn-icon-small delete-group-btn" data-id="${t.id}" title="Eliminar Grupo">‚úñ</button>`:""}
      </div>
    `,o.addEventListener("click",async u=>{if(A){u.preventDefault(),u.stopPropagation(),n.length>0&&n.every(h=>m.has(h.id))?(n.forEach(h=>m.delete(h.id)),o.classList.remove("is-share-selected")):(n.forEach(h=>m.add(h.id)),o.classList.add("is-share-selected")),Se(),c===t.id&&f();return}if(!u.target.closest(".group-tab-actions")){if(t.isLocked&&c!==t.id){const L=prompt(chrome.i18n.getMessage("promptGroupLockedAccess")),h=t.password||"0000";if(L!==h)return}c=t.id,await C(),await f()}}),o.querySelector(".edit-group-btn")?.addEventListener("click",u=>{if(u.stopPropagation(),t.isLocked){const L=prompt(chrome.i18n.getMessage("promptGroupLockedEdit")),h=t.password||"0000";if(L!==h)return}$t(t)}),o.querySelector(".delete-group-btn")?.addEventListener("click",async u=>{if(u.stopPropagation(),t.isLocked){const L=prompt(chrome.i18n.getMessage("promptGroupLockedDelete")),h=t.password||"0000";if(L!==h)return}if(e.length===1){alert(chrome.i18n.getMessage("alertCannotDeleteLastGroup"));return}confirm(chrome.i18n.getMessage("confirmDeleteGroupArg").replace("$1",t.title))&&(await Vt(t.id),c===t.id&&(c=null),await C(),c?await f():r.innerHTML="")}),y.appendChild(o)}setTimeout(_e,50)}let je="";async function f(){if(!c)return;const e=await ue(c);r.innerHTML="";const o=(await k()).find(n=>n.id===c);if(o)if(r.classList.remove("layout-list"),o.layoutType==="dynamic"){const n=o.dynamicWidth||240,s=o.dynamicHeight||180;r.style.gridTemplateColumns=`repeat(auto-fill, minmax(${n}px, 1fr))`,r.style.setProperty("--dial-height",`${s}px`),r.style.setProperty("--dial-aspect-ratio","auto")}else if(o.layoutType==="list"){if(r.classList.add("layout-list"),o.listDirection==="horizontal"){const n=o.listWidth||240;r.style.gridTemplateColumns=`repeat(auto-fill, minmax(${n}px, 1fr))`,r.style.maxWidth="none"}else r.style.gridTemplateColumns="1fr",r.style.maxWidth=`${o.listWidth||800}px`;r.style.margin="0 auto",r.style.setProperty("--dial-height","auto"),r.style.setProperty("--dial-aspect-ratio","auto")}else{r.style.margin="0",r.style.maxWidth="none";const n=o.columns||4;r.style.gridTemplateColumns=`repeat(${n}, minmax(10px, 1fr))`;const s=o.gridAspectWidth||16,i=o.gridAspectHeight||12;r.style.setProperty("--dial-height","auto"),r.style.setProperty("--dial-aspect-ratio",`${s} / ${i}`)}if(e.forEach((n,s)=>{const i=document.createElement("div"),d=m.has(n.id);i.className=`dial-card glass-panel ${d?"is-share-selected":""}`,i.draggable=!A,i.dataset.id=n.id,i.dataset.index=s.toString(),i.addEventListener("click",async v=>{if(F)return;if(A){v.preventDefault(),v.stopPropagation(),m.has(n.id)?(m.delete(n.id),i.classList.remove("is-share-selected")):(m.add(n.id),i.classList.add("is-share-selected")),Se();return}if(v.target.closest(".dial-actions"))return;v.preventDefault();const w=(await k()).find(Ae=>Ae.id===n.groupId);w?.openInNewWindow?typeof chrome<"u"&&chrome.windows?chrome.windows.create({url:n.url}):window.open(n.url,"_blank","menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes"):w?.openInNewTab||v.ctrlKey||v.metaKey||v.button===1?window.open(n.url,"_blank"):window.location.href=n.url});const p=je?`&t=${je}`:"",l=`https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(n.url)}&size=128${p}`,u=Vn(n.title,n.url),L=At[On(n.url)];i.innerHTML=`
      <div class="share-check-badge">
         <svg viewBox="0 0 24 24" fill="none" class="icon" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>
      </div>
      <div class="dial-thumbnail">
        <div class="dial-logo-fallback" style="background: ${L}; position: absolute; inset:0; border-radius: 0; width: 100%; height: 100%;">
           ${u}
        </div>
        <img src="${l}" alt="${n.title}" class="dial-icon-img" style="position:relative; z-index:1; width: 64px; height: 64px; border-radius: 16px; object-fit: contain; box-shadow: 0 10px 20px -5px rgba(0,0,0,0.3); background: white; padding: 4px;">
      </div>
      <div class="dial-footer">
        <h3 class="dial-title" title="${n.title}">${n.title}</h3>
        ${o?.isLocked?"":`
        <div class="dial-actions">
          <button class="dial-action-btn edit-btn" title="Editar">
             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
          </button>
          <button class="dial-action-btn delete-btn" title="Eliminar">
             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
          </button>
        </div>`}
      </div>
    `;const h=i.querySelector(".dial-icon-img");h&&h.addEventListener("error",()=>{h.style.display="none"}),i.addEventListener("dragstart",v=>{if(o?.isLocked){v.preventDefault();return}O=s,v.dataTransfer&&(v.dataTransfer.effectAllowed="move"),i.style.opacity="0.5"}),i.addEventListener("dragover",v=>{v.preventDefault(),v.dataTransfer&&(v.dataTransfer.dropEffect="move")}),i.addEventListener("drop",async v=>{v.preventDefault(),v.stopPropagation();const De=s;if(O!==null&&O!==De&&c){const w=await ue(c),[Ae]=w.splice(O,1);w.splice(De,0,Ae),w.forEach((ie,Rt)=>ie.order=Rt),await ut(w);for(const ie of w)await mt(ie.id,{order:ie.order});await f()}}),i.addEventListener("dragend",()=>{i.style.opacity="1",O=null}),i.querySelector(".edit-btn")?.addEventListener("click",()=>Ke(n)),i.querySelector(".delete-btn")?.addEventListener("click",async()=>{confirm(chrome.i18n.getMessage("confirmDeleteBookmarkArg").replace("$1",n.title))&&(await Yt(n.id),await f())}),r.appendChild(i)}),!A&&!o?.isLocked){const n=document.createElement("div");n.className="dial-card add-dial-card",n.title="A√±adir Nuevo Marcador",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.cursor="pointer",n.style.background="rgba(255, 255, 255, 0.03)",n.style.border="2px dashed rgba(255, 255, 255, 0.2)",n.style.minHeight="140px",n.style.transition="all 0.3s ease",n.innerHTML=`
      <svg viewBox="0 0 24 24" fill="none" class="icon" stroke="currentColor" stroke-width="2" style="width: 48px; height: 48px; opacity: 0.5; stroke: white;">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    `,n.addEventListener("click",()=>{Ke()}),n.addEventListener("mouseenter",()=>{n.style.background="rgba(255, 255, 255, 0.08)",n.style.borderColor="rgba(255, 255, 255, 0.4)"}),n.addEventListener("mouseleave",()=>{n.style.background="rgba(255, 255, 255, 0.03)",n.style.borderColor="rgba(255, 255, 255, 0.2)"}),r.appendChild(n)}}async function Ke(e){if(!c){alert(chrome.i18n.getMessage("alertSelectGroupFirst"));return}if((await k()).find(n=>n.id===c)?.isLocked){alert(chrome.i18n.getMessage("alertGroupLockedAddEdit"));return}me.classList.remove("hidden"),e?(Q=e.id,tt.textContent="Editar Marcador",gt.value=e.title,pt.value=e.url):(Q=null,tt.textContent="A√±adir Marcador",Ze.reset())}function ke(){me.classList.add("hidden"),Ze.reset(),Q=null}tn.addEventListener("click",()=>Ke());nn.addEventListener("click",ke);on.addEventListener("click",ke);me.addEventListener("click",e=>{e.target===me&&ke()});Ze.addEventListener("submit",async e=>{if(e.preventDefault(),!c)return;const t=gt.value.trim();let o=pt.value.trim();!t||!o||(/^https?:\/\//i.test(o)||(o="https://"+o),Q?await mt(Q,{title:t,url:o}):await Kt({groupId:c,title:t,url:o}),ke(),await f())});function _n(e){J.classList.remove("hidden"),b=null,vt.textContent="A√±adir Grupo",Qe.reset()}function we(){J.classList.add("hidden"),Qe.reset(),b=null}an.addEventListener("click",()=>_n());sn.addEventListener("click",we);dn.addEventListener("click",we);J.addEventListener("click",e=>{e.target===J&&we()});Qe.addEventListener("submit",async e=>{e.preventDefault();const t=Pe.value.trim();t&&(b?await rt(b,{title:t}):c=(await Ot(t)).id,we(),await C(),await f())});let a={};function g(){const e=document.getElementById("dial-grid");if(!e)return;if(e.classList.remove("layout-list"),a.layoutType==="dynamic"){const o=a.dynamicWidth||240,n=a.dynamicHeight||180;e.style.gridTemplateColumns=`repeat(auto-fill, minmax(${o}px, 1fr))`,e.style.margin="0",e.style.maxWidth="none",e.style.setProperty("--dial-height",`${n}px`),e.style.setProperty("--dial-aspect-ratio","auto")}else if(a.layoutType==="list"){if(e.classList.add("layout-list"),a.listDirection==="horizontal"){const o=a.listWidth||240;e.style.gridTemplateColumns=`repeat(auto-fill, minmax(${o}px, 1fr))`,e.style.maxWidth="none"}else e.style.gridTemplateColumns="1fr",e.style.maxWidth=`${a.listWidth||800}px`;e.style.margin="0 auto",e.style.setProperty("--dial-height","auto"),e.style.setProperty("--dial-aspect-ratio","auto")}else{e.style.margin="0",e.style.maxWidth="none";const o=a.columns||4;e.style.gridTemplateColumns=`repeat(${o}, minmax(10px, 1fr))`;const n=a.gridAspectWidth||16,s=a.gridAspectHeight||12;e.style.setProperty("--dial-height","auto"),e.style.setProperty("--dial-aspect-ratio",`${n} / ${s}`)}a.gapSize!==void 0?e.style.gap=`${a.gapSize}px`:a.layoutType==="list"&&a.listDirection==="vertical"?e.style.gap="8px":e.style.gap="15px",a.textColor?e.style.color=a.textColor:e.style.color="";const t=document.querySelector(`.group-tab[data-id="${b}"]`);if(t){let o=a.groupIcon?`<span style="margin-right: 6px; font-size: 1.1rem; line-height: 1;">${a.groupIcon}</span>`:"";a.isLocked&&(o+='<svg style="margin-right: 4px; width: 14px; height: 14px; opacity: 0.7;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>'),a.isDefault&&(o+='<svg style="margin-right: 4px; width: 14px; height: 14px; opacity: 0.5;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>');const n=t.querySelector(".group-icon-container");n&&(n.innerHTML=o);const s=t.querySelector(".group-title");s&&(s.textContent=(a.title||"").replace(/^[üìÅüìÇ]\s*/,"").trim()||a.title||"",s.style.color=a.textColor||"")}jn(a)}function jn(e){const t=e.bgType||"none";if(t==="none")document.body.style.background="";else if(t==="solid")document.body.style.background=e.bgColor1||"#28005f";else if(t==="gradient"){const o=e.bgGradientType==="linear"?"linear-gradient":"radial-gradient",n=e.bgGradientType==="linear"?"135deg":e.bgGradientType==="radial-circle"?"circle at center":"ellipse at center",s=e.bgColor1||"#3b82f6",i=e.bgColor2||"#0f172a";document.body.style.background=`${o}(${n}, ${s}, ${i})`}else document.body.style.background=""}function Gt(e){Ge&&(Ge.style.display=e==="solid"?"flex":"none",e==="solid"&&Ge.classList.remove("hidden")),$e&&($e.style.display=e==="gradient"?"flex":"none",e==="gradient"&&$e.classList.remove("hidden"))}function $t(e){b=e.id;const t=e.title.replace(/^[üìÅüìÇ]\s*/,"").trim()||e.title;if(ln.textContent=`Editar grupo: "${t}"`,ht.value=t,a={...e,title:t},ee.textContent=(a.columns||4).toString(),te.textContent=(a.rows||5).toString(),Ne&&(Ne.value=(a.dynamicWidth||240).toString()),Ue&&(Ue.value=(a.dynamicHeight||180).toString()),We&&(We.value=(a.listWidth||240).toString()),Y&&(Y.checked=a.gridFill!==!1),_&&(_.checked=a.gridCenterSlides||!1),ze&&(ze.value=(a.gridAspectWidth||16).toString()),Fe&&(Fe.value=(a.gridAspectHeight||12).toString()),a.layoutType==="dynamic"?ve&&(ve.checked=!0):a.layoutType==="list"?he&&(he.checked=!0):ye&&(ye.checked=!0),de&&de.length>0)if(de.forEach(s=>s.classList.remove("active")),a.groupIcon){const s=document.querySelector(`.adv-icon-choice[data-icon="${a.groupIcon}"]`);s&&s.classList.add("active")}else de[0].classList.add("active");M&&B&&W&&(a.textColor?(M.checked=!0,B.value=a.textColor,W.textContent=a.textColor.toUpperCase()):(M.checked=!1,B.value="#ffffff",W.textContent="#FFFFFF"));const o=a.bgType||"none",n=a.bgGradientType||"radial-ellipse";Lt.forEach(s=>{s.value===o&&(s.checked=!0)}),bt.forEach(s=>{s.value===n&&(s.checked=!0)}),P&&qe&&(P.value=a.bgColor1||"#28005f",qe.textContent=(a.bgColor1||"#28005f").toUpperCase()),N&&Re&&U&&Oe&&(N.value=a.bgColor1||"#3b82f6",Re.textContent=(a.bgColor1||"#3b82f6").toUpperCase(),U.value=a.bgColor2||"#0f172a",Oe.textContent=(a.bgColor2||"#0f172a").toUpperCase()),Gt(o),T&&x&&ce&&(a.gapSize!==void 0?(T.checked=!0,x.value=a.gapSize.toString(),ce.textContent=a.gapSize+"px"):(T.checked=!1,x.value="20",ce.textContent="20px")),j&&(j.checked=a.openInNewWindow||!1),K&&(K.checked=a.openInNewTab||!1),X&&(X.checked=a.isDefault||!1),S&&(S.checked=a.isLocked||!1),z&&D&&(S.checked?(z.style.display="block",D.value=a.password||""):(z.style.display="none",D.value="")),pe.forEach(s=>s.classList.remove("active")),yt.forEach(s=>s.classList.add("hidden")),pe[0].classList.add("active"),document.getElementById("tab-general")?.classList.remove("hidden"),Ee=0,Le=0,fe&&(fe.style.transform="translate(0px, 0px)"),g(),ge.classList.remove("hidden")}nt&&nt.addEventListener("click",()=>{let e=parseInt(ee.textContent||"4");e=Math.min(12,e+1),ee.textContent=e.toString(),a.columns=e,g()});ot&&ot.addEventListener("click",()=>{let e=parseInt(ee.textContent||"4");e=Math.max(1,e-1),ee.textContent=e.toString(),a.columns=e,g()});at&&at.addEventListener("click",()=>{let e=parseInt(te.textContent||"5");e=Math.min(20,e+1),te.textContent=e.toString(),a.rows=e});st&&st.addEventListener("click",()=>{let e=parseInt(te.textContent||"5");e=Math.max(1,e-1),te.textContent=e.toString(),a.rows=e});const et=()=>{ve?.checked?a.layoutType="dynamic":he?.checked?a.layoutType="list":ye?.checked&&(a.layoutType="grid"),g()},Ht=()=>{ft?.checked?a.listDirection="horizontal":Et?.checked&&(a.listDirection="vertical"),g()};ve?.addEventListener("change",et);he?.addEventListener("change",et);ye?.addEventListener("change",et);ft?.addEventListener("change",Ht);Et?.addEventListener("change",Ht);const se=(e,t,o,n,s,i,d=10)=>{if(!e||!t||!o)return;const p=l=>{l=Math.max(s,Math.min(i,l)),e.value=l.toString(),a[n]=l,g()};t.addEventListener("click",l=>{l.preventDefault(),p(parseInt(e.value||"0")+d)}),o.addEventListener("click",l=>{l.preventDefault(),p(parseInt(e.value||"0")-d)}),e.addEventListener("input",()=>{let l=parseInt(e.value);isNaN(l)||(a[n]=l,g())})};se(Ne,mn,gn,"dynamicWidth",50,1e3);se(Ue,pn,vn,"dynamicHeight",50,1e3);se(We,hn,yn,"listWidth",50,1e3);se(ze,fn,En,"gridAspectWidth",1,100,1);se(Fe,Ln,bn,"gridAspectHeight",1,100,1);Y&&Y.addEventListener("change",()=>{a.gridFill=Y.checked,g()});_&&_.addEventListener("change",()=>{a.gridCenterSlides=_.checked,g()});const He=document.getElementById("adv-icon-grid");He&&He.addEventListener("click",e=>{const t=e.target;if(t.classList.contains("adv-icon-choice")){He.querySelectorAll(".adv-icon-choice").forEach(s=>s.classList.remove("active")),t.classList.add("active");const n=t.getAttribute("data-icon");n&&n!=="‚úñ"?a.groupIcon=n:a.groupIcon=void 0,g()}});M&&M.addEventListener("change",()=>{M.checked?(a.textColor=B.value,W.textContent=B.value.toUpperCase()):(a.textColor=void 0,W.textContent="#FFFFFF"),g()});B&&B.addEventListener("input",()=>{W.textContent=B.value.toUpperCase(),M.checked&&(a.textColor=B.value,g())});Lt.forEach(e=>{e.addEventListener("change",()=>{e.checked&&(a.bgType=e.value,Gt(e.value),g())})});bt.forEach(e=>{e.addEventListener("change",()=>{e.checked&&(a.bgGradientType=e.value,g())})});P&&P.addEventListener("input",()=>{qe.textContent=P.value.toUpperCase(),a.bgColor1=P.value,a.bgType==="solid"&&g()});N&&N.addEventListener("input",()=>{Re.textContent=N.value.toUpperCase(),a.bgColor1=N.value,a.bgType==="gradient"&&g()});U&&U.addEventListener("input",()=>{Oe.textContent=U.value.toUpperCase(),a.bgColor2=U.value,a.bgType==="gradient"&&g()});T&&T.addEventListener("change",()=>{T.checked?a.gapSize=parseInt(x.value,10):a.gapSize=void 0,g()});x&&x.addEventListener("input",()=>{ce.textContent=x.value+"px",T.checked&&(a.gapSize=parseInt(x.value,10),g())});j&&j.addEventListener("change",()=>{a.openInNewWindow=j.checked});K&&K.addEventListener("change",()=>{a.openInNewTab=K.checked});X&&X.addEventListener("change",()=>{a.isDefault=X.checked});S&&S.addEventListener("change",()=>{a.isLocked=S.checked,z&&(S.checked?z.style.display="block":(z.style.display="none",D.value="",a.password=void 0))});D&&D.addEventListener("input",()=>{a.password=D.value});function xe(){ge.classList.add("hidden"),b=null,k().then(e=>{const t=e.find(o=>o.id===c);t&&(a={...t},g())})}cn.addEventListener("click",xe);un.addEventListener("click",xe);ge.addEventListener("click",e=>{e.target===ge&&xe()});pe.forEach(e=>{e.addEventListener("click",()=>{pe.forEach(o=>o.classList.remove("active")),yt.forEach(o=>o.classList.add("hidden")),e.classList.add("active");const t=e.getAttribute("data-tab");t&&document.getElementById(t)?.classList.remove("hidden")})});rn.addEventListener("click",async()=>{if(!b)return;const e=ht.value.trim();e&&(a.title=e,await rt(b,a),await C(),await f()),xe()});let F=!1;function Ce(){Ye.classList.toggle("hidden")}function Pt(){F?(document.body.classList.add("edit-mode"),V.textContent="‚úÖ Desactivar Modo Edici√≥n",V.style.background="#10b981"):(document.body.classList.remove("edit-mode"),V.textContent="üõ†Ô∏è Activar Modo Edici√≥n",V.style.background="")}chrome.storage.local.get(["isEditMode"],e=>{F=!!e.isEditMode,Pt()});V.addEventListener("click",()=>{F=!F,chrome.storage.local.set({isEditMode:F}),Pt()});Ct.addEventListener("click",e=>{e.stopPropagation(),E.classList.toggle("hidden")});document.addEventListener("click",e=>{const t=e.target;!E.contains(t)&&t!==Ct&&(E.classList.add("hidden"),document.getElementById("menu-update-thumbnails-container")?.classList.remove("active"),document.getElementById("menu-advanced-container")?.classList.remove("active"))});const Xe=document.getElementById("menu-update-thumbnails-container"),dt=document.getElementById("menu-update-thumbnails"),oe=document.getElementById("menu-advanced-container"),lt=document.getElementById("menu-advanced");dt&&Xe&&dt.addEventListener("click",e=>{e.stopPropagation(),oe?.classList.remove("active"),Xe.classList.toggle("active")});lt&&oe&&lt.addEventListener("click",e=>{e.stopPropagation(),Xe?.classList.remove("active"),oe.classList.toggle("active")});const ct=document.getElementById("menu-help");ct&&ct.addEventListener("click",e=>{e.stopPropagation(),E.classList.add("hidden"),chrome.tabs.create({url:chrome.runtime.getURL("Help.md")})});document.getElementById("sub-update-group")?.addEventListener("click",e=>{e.stopPropagation(),E.classList.add("hidden"),document.getElementById("menu-update-thumbnails-container")?.classList.remove("active");const t=document.querySelectorAll(".dial-icon-img"),o=Date.now();t.forEach(n=>{const s=n.src.split("&t=")[0];n.src=`${s}&t=${o}`,n.style.display="block"})});document.getElementById("sub-update-missing")?.addEventListener("click",e=>{e.stopPropagation(),E.classList.add("hidden"),document.getElementById("menu-update-thumbnails-container")?.classList.remove("active");const t=document.querySelectorAll(".dial-icon-img"),o=Date.now();let n=0;t.forEach(s=>{if(s.style.display==="none"){const i=s.src.split("&t=")[0];s.src=`${i}&t=${o}`,s.style.display="block",n++}}),n===0&&alert("Todas las miniaturas de este grupo est√°n correctamente cargadas.")});document.getElementById("sub-update-all")?.addEventListener("click",async e=>{e.stopPropagation(),E.classList.add("hidden"),document.getElementById("menu-update-thumbnails-container")?.classList.remove("active"),je=Date.now().toString(),await f()});document.getElementById("sub-show-errors")?.addEventListener("click",e=>{e.stopPropagation(),E.classList.add("hidden"),oe?.classList.remove("active"),Xn()});document.getElementById("sub-show-stats")?.addEventListener("click",async e=>{e.stopPropagation(),E.classList.add("hidden"),oe?.classList.remove("active"),await Kn()});async function Kn(){const e=await k(),t=await G();Bn.textContent=e.length.toString(),kn.textContent=t.length.toString();const o=e.length>0?(t.length/e.length).toFixed(1):"0.0";wn.textContent=o,be.classList.remove("hidden")}function Xn(){Ie.classList.remove("hidden")}function Nt(){be.classList.add("hidden")}function Ut(){Ie.classList.add("hidden")}In.addEventListener("click",Nt);be.addEventListener("click",e=>{e.target===be&&Nt()});xn.addEventListener("click",Ut);Ie.addEventListener("click",e=>{e.target===Ie&&Ut()});Sn.addEventListener("click",()=>{Cn.value="",alert(chrome.i18n.getMessage("alertLogCleared"))});function Wt(){q.classList.remove("hidden"),Ve.value="",re.innerHTML="",Ve.focus()}function ae(){q.classList.add("hidden")}document.getElementById("menu-search-dial")?.addEventListener("click",()=>{E.classList.add("hidden"),Wt()});Mn.addEventListener("click",ae);q.addEventListener("click",e=>{e.target===q&&ae()});document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.code==="KeyF"&&(e.preventDefault(),q.classList.contains("hidden")?Wt():ae()),e.key==="Escape"&&(q.classList.contains("hidden")||ae())});Ve.addEventListener("input",async e=>{const t=e.target.value.toLowerCase().trim();if(re.innerHTML="",t.length<1)return;const n=(await G()).filter(s=>s.title.toLowerCase().includes(t)||s.url.toLowerCase().includes(t)).slice(0,15);if(n.length===0){re.innerHTML='<div style="padding: 1rem; color: var(--text-secondary); text-align: center;">No se encontraron resultados.</div>';return}n.forEach(s=>{const i=document.createElement("a");i.href=s.url,i.className="search-result-item",i.addEventListener("click",()=>ae());const d=document.createElement("img");d.className="search-result-favicon",d.src=`https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(s.url)}&size=32`,d.onerror=()=>{d.style.display="none"};const p=document.createElement("div");p.className="search-result-info";const l=document.createElement("span");l.className="search-result-title",l.textContent=s.title;const u=document.createElement("span");u.className="search-result-url",u.textContent=s.url,p.appendChild(l),p.appendChild(u),i.appendChild(d),i.appendChild(p),re.appendChild(i)})});document.getElementById("menu-options")?.addEventListener("click",()=>{E.classList.add("hidden"),Ce()});document.getElementById("menu-select-dials")?.addEventListener("click",()=>{E.classList.add("hidden"),alert(chrome.i18n.getMessage("alertInDevelopment"))});function Se(){const e=m.size;Dn.textContent=`Seleccionado: ${e} diapositivas`,Pn.textContent=`Seleccionado: ${e}`,Nn.textContent=`${e} diapositivas preparadas`}async function Zn(){if(m.size===0){le.innerHTML='<div style="color:var(--text-secondary); text-align:center;">No has seleccionado ninguna diapositiva.</div>';return}const e=await G(),t=await k(),o=e.filter(s=>m.has(s.id)),n={};o.forEach(s=>{n[s.groupId]||(n[s.groupId]=[]),n[s.groupId].push(s)}),le.innerHTML="";for(const[s,i]of Object.entries(n)){const d=t.find(u=>u.id===s),p=d?d.title:"Grupo Desconocido",l=document.createElement("div");l.className="share-group-header",l.innerHTML=`
         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="icon"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
         ${p}:
      `,le.appendChild(l),i.forEach(u=>{const L=document.createElement("div");L.className="share-item-row";const h=`https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(u.url)}&size=32`;L.innerHTML=`
            <img src="${h}" class="share-item-favicon" onerror="this.style.display='none'">
            <div class="share-item-title">${u.title} - <span style="color:var(--text-secondary)">${u.url}</span></div>
         `,le.appendChild(L)})}}function Qn(){A=!0,m.clear(),document.body.classList.add("share-mode-active"),R.classList.remove("hidden"),setTimeout(()=>R.classList.add("active"),10),Se(),C(),f()}function Me(){A=!1,m.clear(),document.body.classList.remove("share-mode-active"),R.classList.remove("active"),setTimeout(()=>R.classList.add("hidden"),300),ne.classList.add("hidden"),C(),f()}function Jn(){R.classList.remove("active"),ne.classList.remove("hidden"),Zn()}function zt(){ne.classList.add("hidden"),R.classList.add("active")}document.getElementById("menu-edit-group")?.addEventListener("click",async e=>{e.stopPropagation(),E.classList.add("hidden");const o=(await k()).find(n=>n.id===c);o?$t(o):alert("Prueba seleccionando un grupo v√°lido en las pesta√±as superiores primero.")});document.getElementById("menu-share-dials")?.addEventListener("click",()=>{E.classList.add("hidden"),Qn()});Tn.addEventListener("click",async()=>{const e=await G();e.length>0&&m.size===e.length?m.clear():e.forEach(o=>m.add(o.id)),Se(),C(),f()});An.addEventListener("click",Me);Gn.addEventListener("click",Jn);$n.addEventListener("click",Me);Hn.addEventListener("click",zt);ne.addEventListener("click",e=>{e.target===ne&&zt()});Un.addEventListener("click",async()=>{if(m.size===0){alert("No has seleccionado ning√∫n marcador.");return}const t=(await G()).filter(s=>m.has(s.id)),n=`${xt.value||"Mis Marcadores"}:

// ====== i18n Localization Layer ======
function localizeUI() {
  document.querySelectorAll('[data-i18n]').forEach((el) => {
    const key = el.getAttribute('data-i18n');
    if (key) {
      const msg = chrome.i18n.getMessage(key);
      if (msg) el.textContent = msg;
    }
  });

  document.querySelectorAll('[data-i18n-placeholder]').forEach((el) => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (key) {
      const msg = chrome.i18n.getMessage(key);
      if (msg) el.setAttribute('placeholder', msg);
    }
  });

  document.querySelectorAll('[data-i18n-title]').forEach((el) => {
    const key = el.getAttribute('data-i18n-title');
    if (key) {
      const msg = chrome.i18n.getMessage(key);
      if (msg) el.setAttribute('title', msg);
    }
  });
}
document.addEventListener('DOMContentLoaded', localizeUI);
// =====================================



`+t.map(s=>`${s.title} - ${s.url}`).join(`
`);try{await navigator.clipboard.writeText(n),alert(chrome.i18n.getMessage("alertBookmarksCopied")),Me()}catch(s){console.error("Error al copiar: ",s),alert(chrome.i18n.getMessage("alertCopyError"))}});Wn.addEventListener("click",async()=>{if(m.size===0){alert("No has seleccionado ning√∫n marcador.");return}const t=(await G()).filter(l=>m.has(l.id)),o=xt.value||"Compartidos";let n=`<!DOCTYPE NETSCAPE-Bookmark-file-1>
<!-- This is an automatically generated file.
     It will be read and overwritten.
     DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
    <DT><H3 ADD_DATE="${Math.floor(Date.now()/1e3)}">${o}</H3>
    <DL><p>
`;t.forEach(l=>{n+=`        <DT><A HREF="${l.url}" ADD_DATE="${Math.floor(Date.now()/1e3)}">${l.title}</A>
`}),n+=`    </DL><p>
</DL><p>`;const s=new Blob([n],{type:"text/html"}),i=URL.createObjectURL(s),d=document.createElement("a");d.href=i;const p=o.replace(/[^a-z0-9]/gi,"_").toLowerCase();d.download=`bookmarks_${p}.html`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(i),Me()});zn.addEventListener("click",Ce);Ye.addEventListener("click",e=>{e.target===Ye&&Ce()});async function Ft(){const e=St,t=Tt;e.textContent="Importando...",t.textContent="Importando...";try{const o=await _t();alert(chrome.i18n.getMessage("alertImportSuccess").replace("$1",String(o))),Be.classList.add("hidden"),Ce(),window.location.reload()}catch(o){console.error(o),alert(chrome.i18n.getMessage("alertImportErrorNative")),e.textContent="ü¶ä Importar del Navegador",t.textContent="ü¶ä Importar Marcadores del Navegador"}}async function qt(e){const t=e.target;if(!t.files||t.files.length===0)return;const o=t.files[0],n=new FileReader;n.onload=async s=>{const i=s.target?.result;try{const d=await jt(i);alert(chrome.i18n.getMessage("alertImportSuccessHTML").replace("$1",String(d))),Be.classList.add("hidden"),window.location.reload()}catch(d){console.error(d),alert(chrome.i18n.getMessage("alertImportErrorHTML"))}},n.readAsText(o)}St.addEventListener("click",Ft);Tt.addEventListener("click",Ft);Fn.addEventListener("click",()=>Mt.click());Mt.addEventListener("change",qt);qn.addEventListener("click",()=>Dt.click());Dt.addEventListener("change",qt);Rn.addEventListener("click",()=>{Be.classList.add("hidden")});if($&&H&&y){const e=()=>y.clientHeight>0?y.clientHeight:38;$.addEventListener("click",()=>{y.scrollBy({top:-e(),behavior:"smooth"})}),H.addEventListener("click",()=>{y.scrollBy({top:e(),behavior:"smooth"})}),y.addEventListener("scroll",_e),window.addEventListener("resize",_e),y.addEventListener("wheel",t=>{if(t.deltaY!==0){t.preventDefault();const o=t.deltaY>0?1:-1;y.scrollBy({top:e()*o,behavior:"auto"})}})}document.addEventListener("contextmenu",e=>{const t=e.target;if((r.contains(t)||t===r)&&c){e.preventDefault(),I.style.display="block";const n=I.getBoundingClientRect(),s=n.width||240,i=n.height||180;let d=e.clientX,p=e.clientY;d+s>window.innerWidth&&(d=window.innerWidth-s),p+i>window.innerHeight&&(p=window.innerHeight-i),I.style.left=`${d}px`,I.style.top=`${p}px`}else I.style.display="none"});document.addEventListener("click",()=>{I&&I.style.display==="block"&&(I.style.display="none")});async function Te(e){if(!c)return;const t=await G(),o=t.filter(i=>i.groupId===c);o.sort(e),o.forEach((i,d)=>{i.order=d});const n=new Set(o.map(i=>i.id)),s=t.filter(i=>!n.has(i.id)).concat(o);await ut(s),I.style.display="none",await f()}Zt?.addEventListener("click",()=>{Te((e,t)=>e.title.toLowerCase().localeCompare(t.title.toLowerCase()))});Qt?.addEventListener("click",()=>{Te((e,t)=>t.title.toLowerCase().localeCompare(e.title.toLowerCase()))});Jt?.addEventListener("click",()=>{Te((e,t)=>parseInt(e.id)-parseInt(t.id))});en?.addEventListener("click",()=>{Te((e,t)=>parseInt(t.id)-parseInt(e.id))});Yn();
