import{a as v,h as w,g as h}from"./api.js";const o=document.getElementById("add-current"),a=document.getElementById("group-select"),l=document.getElementById("new-group-name"),d=document.getElementById("dial-title"),i=document.getElementById("dial-url"),s=document.getElementById("status-message"),p=new URLSearchParams(window.location.search),c=p.get("url"),m=p.get("title");async function y(){if(c&&m)d.value=m,i.value=c;else try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e?.url&&e?.title&&(d.value=e.title,i.value=e.url)}catch(e){console.error(e)}await E()}async function E(){const e=await h();a.innerHTML="";const t=document.createElement("option");t.value="NEW_GROUP",t.textContent="[+] Crear nuevo grupo...",a.appendChild(t),e.length>0?(e.forEach(r=>{const n=document.createElement("option");n.value=r.id,n.textContent=r.title,a.appendChild(n)}),a.value=e[0].id):a.value="NEW_GROUP",g()}function g(){a.value==="NEW_GROUP"?(l.classList.remove("hidden"),l.focus()):l.classList.add("hidden")}a.addEventListener("change",g);o.addEventListener("click",async()=>{let e=a.value;const t=d.value.trim(),r=i.value.trim();if(!t||!r){u("Título y URL son requeridos",!0);return}if(e==="NEW_GROUP"){const n=l.value.trim();if(!n){u("El nombre del grupo es requerido",!0);return}o.disabled=!0;try{e=(await v(n)).id}catch{u("Error al crear grupo",!0),o.disabled=!1;return}}o.disabled=!0;try{await w({groupId:e,title:t,url:r}),o.textContent="¡Guardado!",o.style.backgroundColor="#10b981",setTimeout(()=>window.close(),1e3)}catch(n){console.error(n),u("Error al guardar",!0),o.disabled=!1}});function u(e,t=!1){s.textContent=e,s.classList.remove("hidden"),s.style.color=t?"#ef4444":"#10b981",t&&setTimeout(()=>s.classList.add("hidden"),3e3)}y();
